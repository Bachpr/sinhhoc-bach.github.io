<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trao ƒë·ªïi n∆∞·ªõc ·ªü th·ª±c v·∫≠t ‚Äì 3 giai ƒëo·∫°n</title>
  <meta name="description" content="B√†i h·ªçc t∆∞∆°ng t√°c: H·∫•p th·ª• n∆∞·ªõc & kho√°ng ·ªü l√¥ng h√∫t (th·∫©m th·∫•u, thu ƒë·ªông/ch·ªß ƒë·ªông) ‚Üí V·∫≠n chuy·ªÉn v√†o m·∫°ch g·ªó (apoplast & symplast). C√¢u h·ªèi ƒê√∫ng/Sai, ƒêi·ªÅn, K√©o-th·∫£, Tr·∫£ l·ªùi ng·∫Øn; dark/light mode; ·∫£nh & video."/>

  <style>
    /* ==========================
       1) BI·∫æN M√ÄU CHO LIGHT/DARK
       - D√πng CSS variables ƒë·ªÉ ƒë·ªïi theme nhanh
       ========================== */
    :root{ --bg:#f8fafc; --panel:#ffffff; --text:#0f172a; --muted:#475569; --primary:#2563eb; --primary-contrast:#ffffff; --border:#e2e8f0; --accent:#10b981; --success:#16a34a; --danger:#dc2626; --shadow:0 10px 25px rgba(2,6,23,.08); }
    [data-theme="dark"]{ --bg:#0b1220; --panel:#0f172a; --text:#e5e7eb; --muted:#94a3b8; --primary:#60a5fa; --primary-contrast:#0b1220; --border:#1f2a44; --accent:#34d399; --success:#22c55e; --danger:#f87171; --shadow:0 10px 25px rgba(0,0,0,.35); }

    /* Reset & base */
    *,*::before,*::after{ box-sizing:border-box }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; background:var(--bg); color:var(--text); line-height:1.6 }
    img{ max-width:100%; display:block; border-radius:14px }
    h1,h2,h3{ line-height:1.25; margin:0 0 .5rem }
    p{ margin:.5rem 0 1rem }

    /* Khung trang & thanh ti√™u ƒë·ªÅ d√≠nh */
    .container{ max-width:1100px; margin:0 auto; padding:24px }
    header{ position:sticky; top:0; z-index:10; background:rgba(255,255,255,.6); backdrop-filter:saturate(160%) blur(8px); border-bottom:1px solid var(--border) }
    [data-theme="dark"] header{ background:rgba(15,23,42,.6) }
    .toolbar{ display:flex; align-items:center; gap:12px; justify-content:space-between; padding:12px 24px }

    /* M·ª•c l·ª•c (TOC) n·ªïi */
    nav.toc{ position:sticky; top:60px; z-index:5; background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:10px; margin-top:10px; box-shadow:var(--shadow) }
    nav.toc a{ display:block; color:var(--text); padding:.45rem .6rem; text-decoration:none; border-radius:10px; border:1px solid transparent }
    nav.toc a:hover{ background:linear-gradient(180deg,rgba(148,163,184,.12),transparent); color:var(--primary) }
    nav.toc a.active{ border-color:var(--primary); color:var(--primary); font-weight:700 }

    html{ scroll-behavior:smooth } /* Cu·ªôn m∆∞·ª£t t·ªõi anchor */

    /* L∆∞·ªõi & th·∫ª n·ªôi dung c∆° b·∫£n */
    .grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:18px }
    .card{ grid-column:span 12; background:var(--panel); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow:var(--shadow) }
    @media(min-width:820px){ .card.split{ display:grid; grid-template-columns:1.1fr .9fr; align-items:center } .aside{ grid-column:span 4 } .main{ grid-column:span 8 } .card.half{ grid-column:span 6 } }

    /* N√∫t chung */
    .btn{ border:1px solid var(--border); background:var(--panel); color:var(--text); padding:.6rem 1rem; border-radius:12px; cursor:pointer; font-weight:600 }
    .btn.primary{ background:var(--primary); color:var(--primary-contrast); border-color:transparent }
    .pill{ display:inline-flex; align-items:center; gap:8px; background:rgba(99,102,241,.12); color:var(--primary); padding:.35rem .65rem; border-radius:999px; font-size:.85rem; margin:.2rem .4rem .2rem 0 }
    .status{ font-size:.9rem; color:var(--muted) }

    /* Kho·∫£ng c√°ch gi·ªØa c√°c section ƒë·ªÉ d·ªÖ nh√¨n */
    .section-spacing{ margin-top:40px; margin-bottom:40px }

    /* B·ªô c√¢u h·ªèi: khung & tr·∫°ng th√°i ƒë√∫ng/sai */
    .q-item{ border:1px solid var(--border); border-radius:14px; padding:14px; margin-bottom:12px }
    .q-item.correct{ border-color:var(--success) }
    .q-item.wrong{ border-color:var(--danger) }
    .explain{ font-size:.92rem; color:var(--muted); margin-top:.4rem }
    .score{ font-weight:700 }

    /* M√†u n·ªÅn kh√°c nhau cho t·ª´ng ki·ªÉu c√¢u h·ªèi ƒë·ªÉ d·ªÖ ph√¢n bi·ªát */
    .q-item.truefalse{ background:linear-gradient(180deg,rgba(147,197,253,.12),transparent) }
    .q-item.fill{ background:linear-gradient(180deg,rgba(167,243,208,.12),transparent) }
    .q-item.short{ background:linear-gradient(180deg,rgba(253,230,138,.12),transparent) }
    .q-item.dragdrop{ background:linear-gradient(180deg,rgba(196,181,253,.12),transparent) }

    /* √î nh·∫≠p li·ªáu ƒë·∫πp & nh·∫•t qu√°n */
    .input, textarea.input{ display:block; width:100%; padding:.6rem .8rem; border:1px solid var(--border); border-radius:12px; background:var(--panel); color:var(--text); font-size:1rem; margin-top:.4rem; transition:border-color .2s ease, box-shadow .2s ease }
    .input:focus, textarea.input:focus{ border-color:var(--primary); box-shadow:0 0 0 3px rgba(37,99,235,.15); outline:none }
    textarea.input{ min-height:60px; resize:vertical }

    /* K√©o‚Äìth·∫£: l√†m ƒë·∫πp ng√¢n h√†ng token & √¥ nh·∫≠n */
    .dd-bank{ display:flex; flex-wrap:wrap; gap:8px; padding:8px; border:1px dashed var(--border); border-radius:14px; background:rgba(148,163,184,.08) }
    .dd-token{ padding:.4rem .7rem; border:1px solid var(--border); border-radius:999px; background:var(--panel); box-shadow:0 1px 3px rgba(0,0,0,.08); cursor:grab; transition:transform .15s ease }
    .dd-token:active{ transform:scale(.95) }
    .dd-row{ display:grid; grid-template-columns:1fr 180px; gap:10px; align-items:center; margin:.5rem 0 }
    .dd-drop{ min-height:40px; border:1px dashed var(--border); border-radius:14px; padding:.4rem .6rem; background:rgba(255,255,255,.4); transition:background .2s ease, border-color .2s ease }
    .dd-drop:empty::before{ content:'K√©o th·∫£ v√†o ƒë√¢y'; font-size:.85rem; color:var(--muted) }
    .dd-drop:hover{ border-color:var(--primary); background:rgba(148,163,184,.15) }

    /* Hi·ªáu ·ª©ng khi ƒë·ªïi theme: m∆∞·ª£t m√†u n·ªÅn/ch·ªØ/vi·ªÅn */
    html, body, .card, .btn, nav.toc, .q-item, .input, textarea.input, .dd-drop, .dd-token{ transition:background-color .4s ease, color .4s ease, border-color .4s ease, box-shadow .4s ease }

    /* Ti√™u ƒë·ªÅ t·ª´ng giai ƒëo·∫°n m·ªói m√†u ri√™ng ƒë·ªÉ tr·ª±c quan */
    #giai-doan-1 h2{ color:#2563eb }
    #giai-doan-2 h2{ color:#10b981 }
    #giai-doan-3 h2{ color:#f59e0b }

    /* Question Palette: d·∫£i s·ªë c√¢u h·ªèi ƒë·ªÉ nh·∫£y nhanh & theo d√µi ti·∫øn ƒë·ªô */
    #questionPalette{ margin:10px 0; display:flex; flex-wrap:wrap; gap:6px }
    .q-pal-btn{ width:32px; height:32px; display:flex; align-items:center; justify-content:center; border-radius:8px; border:1px solid var(--border); background:var(--panel); color:var(--text); cursor:pointer; transition:background .2s ease, border-color .2s ease }
    .q-pal-btn:hover{ border-color:var(--primary) }
    .q-pal-btn.done{ background:var(--accent); color:#fff }

    /* ===== L√†m ƒë·∫πp thanh b·ªô l·ªçc (m·ª©c ƒë·ªô & ki·ªÉu c√¢u h·ªèi) ===== */
    .filter-bar{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;background:linear-gradient(180deg,rgba(148,163,184,.12),transparent);border:1px solid var(--border);border-radius:14px;padding:10px}
    .filter-bar .group{display:flex;align-items:center;gap:8px;font-weight:600}
    .select{appearance:none;-webkit-appearance:none;-moz-appearance:none;padding:.55rem .9rem;border:1px solid var(--border);border-radius:10px;background:var(--panel);color:var(--text);cursor:pointer;min-width:160px;line-height:1.2;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2364738b' viewBox='0 0 16 16'%3E%3Cpath d='M3.2 6l4.8 5L12.8 6H3.2z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .6rem center;background-size:16px}
    .select:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15)}

    /* ===== Header m·ªói c√¢u v·ªõi icon ===== */
    .q-header{display:flex;align-items:center;gap:10px;font-weight:700;margin-bottom:.35rem}
    .q-icon{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:999px;background:rgba(148,163,184,.18);border:1px solid var(--border);font-size:14px}

    /* ===== Ph∆∞∆°ng √°n ch·ªçn ƒê√∫ng/Sai d·∫°ng "pill" ƒë·∫πp m·∫Øt ===== */
    .choices{display:flex;gap:10px;flex-wrap:wrap;margin-top:.4rem}
    .choice{display:flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:12px;padding:.45rem .7rem;cursor:pointer;background:var(--panel)}
    .choice input{display:none}
    .choice input:checked + span{border-color:var(--primary);background:linear-gradient(180deg,rgba(37,99,235,.15),transparent);color:var(--primary);padding:.1rem .2rem;border-radius:8px}

    .footer{ margin:28px 0 40px; color:var(--muted); text-align:center }
  </style>
</head>
<body>
  <!-- ==========================
       HEADER + N√öT CHUY·ªÇN CH·∫æ ƒê·ªò
       ========================== -->
  <header>
    <div class="toolbar container">
      <div>
        <h1>Trao ƒë·ªïi n∆∞·ªõc ·ªü th·ª±c v·∫≠t</h1>
        <div class="status">B√†i h·ªçc t∆∞∆°ng t√°c ¬∑ 3 giai ƒëo·∫°n ¬∑ c√≥ ·∫£nh & video</div>
      </div>
      <!-- N√∫t ƒë·ªïi theme: icon s·∫Ω ƒë·ªïi theo tr·∫°ng th√°i (JS b√™n d∆∞·ªõi) -->
      <button class="btn" id="themeBtn" aria-label="Chuy·ªÉn ch·ªß ƒë·ªÅ">üåô/‚òÄÔ∏è</button>
    </div>
  </header>

  <!-- ==========================
       TH√ÇN TRANG: HEADING + TOC + N·ªòI DUNG
       ========================== -->
  <main class="container">
    <!-- Heading trang trong m·ªôt card ƒë·ªÉ n·ªïi b·∫≠t -->
    <section class="grid section-spacing" id="bai-lam">
      <article class="card">
        <h1 style="text-align:center;font-size:2rem;margin:10px 0;">B√†i l√†m v·ªÅ trao ƒë·ªïi n∆∞·ªõc ·ªü th·ª±c v·∫≠t</h1>
      </article>
    </section>

    <!-- N√∫t ·∫©n/hi·ªán m·ª•c l·ª•c ƒë·ªÉ ti·∫øt ki·ªám kh√¥ng gian tr√™n m√†n h√¨nh nh·ªè -->
    <button class="btn" id="toggleToc" style="margin-bottom:10px">Hi·ªán/·∫®n m·ª•c l·ª•c</button>

    <!-- TOC: c√°c anchor ƒë·∫øn t·ª´ng ph·∫ßn; c√≥ scrollspy ƒë·ªÉ b√¥i ƒë·∫≠m m·ª•c ƒëang xem -->
    <nav class="toc" id="tocNav">
      <strong>ƒêi t·ªõi m·ª•c:</strong>
      <a href="#giai-doan-1">‚ë† H·∫•p th·ª• ·ªü l√¥ng h√∫t</a>
      <a href="#giai-doan-2">‚ë° V·∫≠n chuy·ªÉn v√†o m·∫°ch g·ªó</a>
      <a href="#giai-doan-3">‚ë¢ V·∫≠n chuy·ªÉn l√™n & tho√°t h∆°i</a>
      <a href="#quizSection">C√¢u h·ªèi ki·ªÉm tra</a>
    </nav>

    <!-- ===== GIAI ƒêO·∫†N 1: L√îNG H√öT ===== -->
    <section class="grid section-spacing" id="giai-doan-1">
      <article class="card half">
        <h2>‚ë† H·∫•p th·ª• n∆∞·ªõc ·ªü t·∫ø b√†o l√¥ng h√∫t</h2>
        <p><strong>Th·∫©m th·∫•u:</strong> N∆∞·ªõc di chuy·ªÉn <em>t·ª´ ƒë·∫•t</em> (th·∫ø n∆∞·ªõc cao) <em>v√†o</em> t·∫ø b√†o l√¥ng h√∫t (th·∫ø n∆∞·ªõc th·∫•p) qua m√†ng sinh ch·∫•t.</p>
        <h3>H·∫•p th·ª• kho√°ng ·ªü l√¥ng h√∫t</h3>
        <ul>
          <li><strong>Thu ƒë·ªông:</strong> Ion ƒëi theo <em>gradien n·ªìng ƒë·ªô</em> t·ª´ ƒë·∫•t ‚Üí r·ªÖ, <em>kh√¥ng ti√™u t·ªën nƒÉng l∆∞·ª£ng</em>.</li>
          <li><strong>Ch·ªß ƒë·ªông:</strong> Ion ƒëi <em>ng∆∞·ª£c gradien n·ªìng ƒë·ªô</em> nh·ªù b∆°m m√†ng d√πng <abbr title="Adenosine triphosphate">ATP</abbr>.</li>
        </ul>
      </article>
      <article class="card half">
        <!-- ·∫¢nh minh ho·∫° r·ªÖ/l√¥ng h√∫t -->
        <img alt="L√¥ng h√∫t r·ªÖ" src="https://video.vietjack.com/upload2/quiz_source1/2022/01/screenshot-1641367523-1641367406.png"/>
      </article>
    </section>

    <!-- ===== GIAI ƒêO·∫†N 2: V√ÄO M·∫†CH G·ªñ ===== -->
    <section class="grid section-spacing" id="giai-doan-2">
      <article class="card split">
        <div class="main">
          <h2>‚ë° V·∫≠n chuy·ªÉn n∆∞·ªõc & kho√°ng t·ª´ l√¥ng h√∫t v√†o m·∫°ch g·ªó c·ªßa r·ªÖ</h2>
          <p>Di·ªÖn ra qua <strong>hai con ƒë∆∞·ªùng</strong>:</p>
          <ul>
            <li><strong>Con ƒë∆∞·ªùng gian b√†o (apoplast):</strong> n∆∞·ªõc/ion ƒëi <em>gi·ªØa c√°c th√†nh t·∫ø b√†o</em> t·ªõi ƒëai Caspari (n·ªôi b√¨).</li>
            <li><strong>Con ƒë∆∞·ªùng t·∫ø b√†o ch·∫•t (symplast):</strong> ƒëi <em>trong t·∫ø b√†o ch·∫•t</em> qua c·∫ßu n·ªëi <em>plasmodesmata</em>.</li>
          </ul>
          <p class="status">ƒêai Caspari ch·∫∑n d√≤ng gian b√†o, bu·ªôc n∆∞·ªõc/ion <em>qua m√†ng</em> tr∆∞·ªõc khi v√†o m·∫°ch g·ªó ‚Üí ki·ªÉm so√°t ch·ªçn l·ªçc.</p>
        </div>
        <div class="aside">
          <!-- Nh√∫ng video: d√πng ID YouTube tr·ª±c ti·∫øp ƒë·ªÉ tr√°nh redirect -->
          <iframe title="Video minh h·ªça" width="100%" height="260" style="border:0;border-radius:14px" src="https://www.youtube.com/embed/JFPOxRfsBWQ" loading="lazy" allowfullscreen></iframe>
          <div class="status">Video YouTube theo li√™n k·∫øt b·∫°n cung c·∫•p.</div>
        </div>
      </article>
    </section>

    <!-- ===== GIAI ƒêO·∫†N 3: L√äN TH√ÇN & THO√ÅT H∆†I ===== -->
    <section class="grid section-spacing" id="giai-doan-3">
      <article class="card half">
        <h2>‚ë¢ V·∫≠n chuy·ªÉn l√™n & tho√°t h∆°i ·ªü l√°</h2>
        <p>C·ªôt n∆∞·ªõc trong m·∫°ch g·ªó ƒë∆∞·ª£c <em>k√©o</em> l√™n nh·ªù tho√°t h∆°i n∆∞·ªõc t·∫°i l√°, ƒë·ªìng th·ªùi n∆∞·ªõc tho√°t ch·ªß y·∫øu qua <strong>kh√≠ kh·ªïng</strong>.</p>
        <details>
          <summary>T√≥m t·∫Øt chu·ªói l·ª±c ƒë·∫©y ‚Äì k√©o</summary>
          <ol>
            <li>Tho√°t h∆°i ·ªü l√° ‚Üí gi·∫£m th·∫ø n∆∞·ªõc ·ªü l√°</li>
            <li>H√∫t n∆∞·ªõc t·ª´ xylem ·ªü r·ªÖ ‚Äì th√¢n ‚Üí tƒÉng h√∫t t·ª´ ƒë·∫•t</li>
            <li>C·ªßng c·ªë d√≤ng n∆∞·ªõc/kho√°ng t·ª´ l√¥ng h√∫t ‚Üí m·∫°ch g·ªó</li>
          </ol>
        </details>
      </article>
      <article class="card half">
        <!-- ·∫¢nh minh ho·∫° l√°/gi·ªçt n∆∞·ªõc -->
        <img alt="Gi·ªçt n∆∞·ªõc tr√™n l√°" src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=1200&auto=format&fit=crop&sat=-30"/>
      </article>
    </section>

    <!-- ==========================
         KH·ªêI C√ÇU H·ªéI T∆Ø∆†NG T√ÅC
         ========================== -->
    <section class="grid section-spacing">
      <article class="card">
        <!-- N√∫t ·∫©n/hi·ªán to√†n b·ªô ph·∫ßn c√¢u h·ªèi -->
        <button class="btn primary" id="toggleQuiz">Hi·ªán/·∫®n c√¢u h·ªèi</button>

        <div id="quizSection" style="display:none;margin-top:12px">
          <h2 id="quizSectionHeading">C√¢u h·ªèi ki·ªÉm tra ki·∫øn th·ª©c</h2>
          <div class="status">Ch·ªçn m·ª©c ƒë·ªô & ki·ªÉu c√¢u h·ªèi ƒë√∫ng v·ªõi n·ªôi dung ba giai ƒëo·∫°n.</div>

          <!-- B·ªô l·ªçc m·ª©c ƒë·ªô & ki·ªÉu c√¢u h·ªèi -->
          <div class="filter-bar">
            <label class="group">M·ª©c ƒë·ªô
              <select id="levelFilter" class="select">
                <option value="all">T·∫•t c·∫£</option>
                <option value="easy">D·ªÖ</option>
                <option value="medium">Trung b√¨nh</option>
                <option value="hard">Kh√≥</option>
              </select>
            </label>
            <label class="group">Ki·ªÉu c√¢u h·ªèi
              <select id="typeFilter" class="select">
                <option value="all">T·∫•t c·∫£</option>
                <option value="truefalse">ƒê√∫ng/Sai</option>
                <option value="fill">ƒêi·ªÅn</option>
                <option value="short">Tr·∫£ l·ªùi ng·∫Øn</option>
                <option value="dragdrop">K√©o-th·∫£</option>
              </select>
            </label>
          </div>

          <!-- Question Palette: hi·ªán danh s√°ch s·ªë c√¢u h·ªèi, th√™m sau khi render -->
          <div id="questionPalette" aria-label="Danh s√°ch c√¢u h·ªèi"></div>

          <!-- V√πng s·∫Ω render c√¢u h·ªèi -->
          <div id="quiz" style="margin-top:10px"></div>

          <!-- N√∫t n·ªôp b√†i / l√†m l·∫°i + ƒëi·ªÉm -->
          <div style="display:flex; gap:10px; margin-top:10px">
            <button class="btn" id="submitQuiz" aria-label="N·ªôp b√†i">N·ªôp b√†i</button>
            <button class="btn" id="resetQuiz" aria-label="L√†m l·∫°i">L√†m l·∫°i</button>
            <div style="margin-left:auto" class="score" id="scoreBox" aria-live="polite">ƒêi·ªÉm: 0/0</div>
          </div>
        </div>
      </article>
    </section>

    <p class="footer">¬© 2025 B√†i h·ªçc m√¥ ph·ªèng</p>
  </main>

  <script>
    /* ======================================
       THEME TOGGLE (LIGHT/DARK) + ICON
       - L∆∞u theme v√†o localStorage
       - ƒê·ªïi icon theo tr·∫°ng th√°i hi·ªán t·∫°i
       ====================================== */
    const savedTheme = localStorage.getItem('theme');
    const themeBtn = document.getElementById('themeBtn');
    if(savedTheme){
      document.documentElement.setAttribute('data-theme', savedTheme);
      themeBtn.textContent = savedTheme==='dark' ? '‚òÄÔ∏è' : 'üåô'; // dark ‚Üí g·ª£i √Ω chuy·ªÉn sang s√°ng
    }else{
      themeBtn.textContent = 'üåô'; // m·∫∑c ƒë·ªãnh hi·ªán trƒÉng (ƒëang s√°ng)
    }
    themeBtn.addEventListener('click',()=>{
      const current = document.documentElement.getAttribute('data-theme');
      const next = current==='dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      themeBtn.textContent = next==='dark' ? '‚òÄÔ∏è' : 'üåô';
    });

    /* ======================================
       ·∫®N/HI·ªÜN M·ª§C L·ª§C (TOC)
       - D√πng class .hidden ƒë·ªÉ tr∆∞·ª£t ·∫©n/hi·ªán b·∫±ng CSS transition
       ====================================== */
    const toggleTocBtn = document.getElementById('toggleToc');
    const tocNav = document.getElementById('tocNav');
    // Chu·∫©n b·ªã CSS ƒë·ªông cho hi·ªáu ·ª©ng ·∫©n/hi·ªán (ƒë·∫∑t ·ªü ƒë√¢y ƒë·ªÉ t√°ch bi·ªát logic)
    tocNav.style.transition = 'transform .3s ease, opacity .3s ease';
    const hideClass = 'hidden';
    const styleHidden = document.createElement('style');
    styleHidden.textContent = `#tocNav.hidden{transform:translateX(-110%);opacity:0;pointer-events:none}`;
    document.head.appendChild(styleHidden);
    toggleTocBtn.addEventListener('click',()=> tocNav.classList.toggle(hideClass));

    /* ======================================
       TOC: CU·ªòN M∆Ø·ª¢T + SCROLLSPY
       - Ch·∫∑n m·∫∑c ƒë·ªãnh khi click, d√πng scrollIntoView
       - IntersectionObserver ƒë√°nh d·∫•u m·ª•c ƒëang hi·ªán trong viewport
       ====================================== */
    const tocLinks = Array.from(document.querySelectorAll('nav.toc a'));
    tocLinks.forEach(a=>{
      a.addEventListener('click', (e)=>{
        const sel = document.querySelector(a.getAttribute('href'));
        if(sel){ e.preventDefault(); sel.scrollIntoView({behavior:'smooth', block:'start'}); history.replaceState(null,'',a.getAttribute('href')); }
      });
    });
    const targets = tocLinks.map(a=>document.querySelector(a.getAttribute('href'))).filter(Boolean);
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(entry=>{
        const id = '#' + entry.target.id;
        const link = tocLinks.find(a=>a.getAttribute('href')===id);
        if(!link) return;
        if(entry.isIntersecting){
          tocLinks.forEach(l=>l.classList.remove('active'));
          link.classList.add('active');
        }
      });
    }, {root:null, rootMargin:'-45% 0px -50% 0px', threshold:0});
    targets.forEach(t=> io.observe(t));

    /* ======================================
       NG√ÇN H√ÄNG C√ÇU H·ªéI
       - type: 'truefalse' | 'fill' | 'short' | 'dragdrop'
       - level: 'easy' | 'medium' | 'hard'
       ====================================== */
    const QUESTIONS = [
      // ----- D·ªÑ -----
      { type:'truefalse', level:'easy',
        q:'(ƒê√∫ng/Sai) N∆∞·ªõc v√†o t·∫ø b√†o l√¥ng h√∫t nh·ªù th·∫©m th·∫•u t·ª´ ƒë·∫•t v√†o t·∫ø b√†o.',
        answer:true,
        explain:'ƒê√∫ng. N∆∞·ªõc ƒëi theo ch√™nh l·ªách th·∫ø n∆∞·ªõc qua m√†ng sinh ch·∫•t c·ªßa t·∫ø b√†o l√¥ng h√∫t.'
      },
      { type:'fill', level:'easy',
        q:'ƒêi·ªÅn: H·∫•p th·ª• kho√°ng thu ƒë·ªông di·ªÖn ra theo ______ n·ªìng ƒë·ªô t·ª´ ƒë·∫•t v√†o r·ªÖ.',
        answers:[[ 'gradien','gradient','theo gradien','theo gradient' ]],
        explain:'Thu ƒë·ªông l√† theo gradien n·ªìng ƒë·ªô, kh√¥ng t·ªën nƒÉng l∆∞·ª£ng.'
      },
      { type:'short', level:'easy',
        q:'K·ªÉ t√™n m·ªôt trong hai con ƒë∆∞·ªùng t·ª´ l√¥ng h√∫t v√†o m·∫°ch g·ªó.',
        acceptable:['apoplast','gian b√†o','symplast','t·∫ø b√†o ch·∫•t'],
        explain:'Hai con ƒë∆∞·ªùng: apoplast (gian b√†o) v√† symplast (t·∫ø b√†o ch·∫•t).'
      },

      // ----- TRUNG B√åNH -----
      { type:'truefalse', level:'medium',
        q:'(ƒê√∫ng/Sai) V·∫≠n chuy·ªÉn kho√°ng ch·ªß ƒë·ªông ƒëi c√πng chi·ªÅu gradien n·ªìng ƒë·ªô v√† c·∫ßn ATP.',
        answer:false,
        explain:'Sai. Ch·ªß ƒë·ªông ƒëi NG∆Ø·ª¢C gradien v√† c·∫ßn ATP.'
      },
      { type:'fill', level:'medium',
        q:'ƒêi·ªÅn 2 ch·ªó tr·ªëng: Con ƒë∆∞·ªùng ______ (ƒëi gi·ªØa th√†nh t·∫ø b√†o) v√† con ƒë∆∞·ªùng ______ (ƒëi qua t·∫ø b√†o ch·∫•t).',
        answers:[[ 'apoplast','gian b√†o' ],[ 'symplast','t·∫ø b√†o ch·∫•t' ]],
        explain:'Apoplast = gian b√†o; Symplast = t·∫ø b√†o ch·∫•t qua plasmodesmata.'
      },
      { type:'short', level:'medium',
        q:'ƒêai Caspari c√≥ vai tr√≤ g√¨ tr∆∞·ªõc khi n∆∞·ªõc/ion v√†o m·∫°ch g·ªó?',
        acceptable:['ch·∫∑n gian b√†o','bu·ªôc qua m√†ng','ki·ªÉm so√°t ch·ªçn l·ªçc','n·ªôi b√¨ ch·∫∑n d√≤ng gian b√†o','caspari'],
        explain:'ƒêai Caspari ch·∫∑n d√≤ng apoplast, bu·ªôc ƒëi qua m√†ng ‚Üí ki·ªÉm so√°t ch·ªçn l·ªçc.'
      },
      { type:'dragdrop', level:'medium',
        q:'K√©o th·∫£ thu·∫≠t ng·ªØ v√†o m√¥ t·∫£ ƒë√∫ng.',
        pairs:[ {prompt:'Thu ƒë·ªông',targetId:'t1'},{prompt:'Ch·ªß ƒë·ªông',targetId:'t2'},{prompt:'Th·∫©m th·∫•u',targetId:'t3'} ],
        tokens:[ {id:'t1',label:'Ion theo gradien n·ªìng ƒë·ªô (kh√¥ng d√πng ATP)'}, {id:'t2',label:'Ion ng∆∞·ª£c gradien (c·∫ßn ATP)'}, {id:'t3',label:'N∆∞·ªõc theo th·∫ø n∆∞·ªõc qua m√†ng t·ª´ cao ‚Üí th·∫•p'} ],
        explain:'Thu ƒë·ªông‚Üîgradien; Ch·ªß ƒë·ªông‚Üîng∆∞·ª£c gradien (ATP); Th·∫©m th·∫•u‚Üîn∆∞·ªõc theo th·∫ø n∆∞·ªõc.'
      },

      // ----- KH√ì -----
      { type:'truefalse', level:'hard',
        q:'(ƒê√∫ng/Sai) ·ªû n·ªôi b√¨, n∆∞·ªõc c√≥ th·ªÉ ƒëi apoplast v√†o m·∫°ch g·ªó m√† kh√¥ng qua m√†ng.',
        answer:false,
        explain:'Sai. ƒêai Caspari ch·∫∑n apoplast, b·∫Øt bu·ªôc chuy·ªÉn sang symplast (qua m√†ng).'
      },
      { type:'fill', level:'hard',
        q:'ƒêi·ªÅn: V·∫≠n chuy·ªÉn ch·ªß ƒë·ªông th∆∞·ªùng d√πng c√°c ______ m√†ng s·ª≠ d·ª•ng ______ l√†m nƒÉng l∆∞·ª£ng.',
        answers:[[ 'b∆°m','protein v·∫≠n chuy·ªÉn','ch·∫•t v·∫≠n chuy·ªÉn' ],[ 'atp' ]],
        explain:'B∆°m/transporters d√πng ATP ƒë·ªÉ ƒë·∫©y ion ng∆∞·ª£c gradien.'
      },
      { type:'short', level:'hard',
        q:'N√™u m·ªôt l·ª£i √≠ch sinh l√Ω c·ªßa ki·ªÉm so√°t ch·ªçn l·ªçc t·∫°i ƒëai Caspari.',
        acceptable:['ngƒÉn ion ƒë·ªôc','duy tr√¨ c√¢n b·∫±ng ion','ƒëi·ªÅu ho√† h·∫•p thu','b·∫£o v·ªá m·∫°ch g·ªó','·ªïn ƒë·ªãnh n·ªôi m√¥i r·ªÖ','l·ªçc ion'],
        explain:'Gi√∫p tr√°nh ion ƒë·ªôc, gi·ªØ c√¢n b·∫±ng dinh d∆∞·ª°ng tr∆∞·ªõc khi v√†o xylem.'
      },
      { type:'dragdrop', level:'hard',
        q:'K√©o th·∫£: gh√©p thu·∫≠t ng·ªØ ‚Äì v·ªã tr√≠/ƒë·∫∑c ƒëi·ªÉm.',
        pairs:[ {prompt:'Apoplast',targetId:'d1'},{prompt:'Symplast',targetId:'d2'},{prompt:'ƒêai Caspari',targetId:'d3'} ],
        tokens:[ {id:'d1',label:'Khoang gian b√†o & th√†nh t·∫ø b√†o'}, {id:'d2',label:'Li√™n t·ª•c t·∫ø b√†o ch·∫•t qua plasmodesmata'}, {id:'d3',label:'D·∫£i suberin ·ªü n·ªôi b√¨ ch·∫∑n apoplast'} ],
        explain:'Apoplast‚Üîgian b√†o; Symplast‚Üît·∫ø b√†o ch·∫•t; Caspari‚Üîn·ªôi b√¨ ch·∫∑n apoplast.'
      }
    ];

    /* ======================================
       H√ÄM TI·ªÜN √çCH: Chu·∫©n ho√° chu·ªói ƒë·ªÉ so kh·ªõp linh ho·∫°t
       - H·∫° ch·ªØ th∆∞·ªùng, b·ªè d·∫•u ti·∫øng Vi·ªát (NFD), b·ªè kho·∫£ng th·ª´a
       ====================================== */
    const norm = (s)=> (s||'').toString().toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').trim();

    /* ======================================
       RENDER C√ÇU H·ªéI
       - L·ªçc theo m·ª©c ƒë·ªô & ki·ªÉu
       - T·∫°o HTML cho t·ª´ng lo·∫°i
       - G·∫Øn DnD cho c√¢u k√©o‚Äìth·∫£
       ====================================== */
    const quizDiv = document.getElementById('quiz');
    const paletteDiv = document.getElementById('questionPalette'); // d·∫£i s·ªë c√¢u h·ªèi
    const levelFilter = document.getElementById('levelFilter');
    const typeFilter = document.getElementById('typeFilter');

    function filteredQuestions(){
      return QUESTIONS.filter(q=> (levelFilter.value==='all'||q.level===levelFilter.value) && (typeFilter.value==='all'||q.type===typeFilter.value));
    }

    function renderQuiz(){
      quizDiv.innerHTML='';
      const qs = filteredQuestions();
      qs.forEach((item, idx)=>{
        // T·∫°o khung c√¢u h·ªèi, th√™m class ph·ª• theo ki·ªÉu ƒë·ªÉ ƒë·ªïi n·ªÅn
        const wrap = document.createElement('div');
        wrap.className = `q-item ${item.type}`;

        // Ph·∫ßn ti√™u ƒë·ªÅ m·ªói c√¢u (in ƒë·∫≠m + s·ªë th·ª© t·ª±)
        const icon = item.type==='truefalse'?'‚úÖ':item.type==='fill'?'‚úçÔ∏è':item.type==='short'?'üìù':'üîó';
        let html = `<div class=\"q-header\"><span class=\"q-icon\">${icon}</span><span class=\"q-title\">[${item.level.toUpperCase()}] ${idx+1}. ${item.q}</span></div>`;

        // Render n·ªôi dung theo ki·ªÉu c√¢u h·ªèi
        if(item.type==='truefalse'){
          // T·∫°o 2 l·ª±a ch·ªçn d·∫°ng pill ƒë·∫πp m·∫Øt v·ªõi input ·∫©n + span hi·ªÉn th·ªã
          const opts = [ ['ƒê√∫ng',true], ['Sai',false] ].map(([lab,val])=>
            `<label class='choice'><input type='radio' name='q${idx}' value='${val}'/><span>${lab}</span></label>`
          ).join('');
          html += `<div class='choices'>${opts}</div>`;
        } else if(item.type==='fill'){
          // T·∫°o N √¥ tr·ªëng theo m·∫£ng answers
          html += item.answers.map((_,i)=>`<input class='input' style='margin-top:.5rem' placeholder='√î tr·ªëng ${i+1}' data-blank='${i}'/>`).join('');
        } else if(item.type==='short'){
          html += `<textarea class='input' rows='2' placeholder='Nh·∫≠p ƒë√°p √°n ng·∫Øn...'></textarea>`;
        } else if(item.type==='dragdrop'){
          // Ng√¢n h√†ng token ƒë·ªÉ k√©o
          html += `<div class='dd-bank'>${item.tokens.map(t=>`<span class='dd-token' draggable='true' data-id='${t.id}'>${t.label}</span>`).join('')}</div>`;
          // √î nh·∫≠n t∆∞∆°ng ·ª©ng v·ªõi c·∫∑p gh√©p m·ª•c ti√™u
          html += item.pairs.map((p,i)=>`<div class='dd-row'><div>${i+1}. ${p.prompt}</div><div class='dd-drop' data-target='${p.targetId}'></div></div>`).join('');
        }

        // Gi·∫£i th√≠ch s·∫Ω ·∫©n cho ƒë·∫øn khi n·ªôp b√†i
        html += `<div class='explain' hidden>${item.explain}</div>`;
        wrap.innerHTML = html;
        quizDiv.appendChild(wrap);

        // K√≠ch ho·∫°t k√©o‚Äìth·∫£ cho c√¢u lo·∫°i dragdrop
        if(item.type==='dragdrop') enableDnD(wrap);
      });

      // C·∫≠p nh·∫≠t t·ªïng s·ªë c√¢u ƒë·ªÉ hi·ªÉn th·ªã ƒëi·ªÉm d·∫°ng 0/N
      document.getElementById('scoreBox').textContent = `ƒêi·ªÉm: 0/${qs.length}`;

      // Render Question Palette sau khi ƒë√£ render c√¢u h·ªèi
      renderPalette();
      markPalette();
    }

    /* ======================================
       K√âO‚ÄìTH·∫¢ (Drag & Drop)
       - L·∫Øng nghe dragstart/dragover/drop cho token & √¥ nh·∫≠n
       - L∆∞u ID token trong dataTransfer ƒë·ªÉ so kh·ªõp ƒë√≠ch
       ====================================== */
    function enableDnD(scope){
      const tokens = scope.querySelectorAll('.dd-token');
      const drops = scope.querySelectorAll('.dd-drop');

      tokens.forEach(tok=>{
        tok.addEventListener('dragstart', e=>{
          e.dataTransfer.setData('text/plain', tok.dataset.id); // chuy·ªÉn ID token qua dataTransfer
        });
      });

      drops.forEach(drop=>{
        drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.style.background='rgba(148,163,184,.12)'; });
        drop.addEventListener('dragleave', ()=>{ drop.style.background=''; });
        drop.addEventListener('drop', e=>{
          e.preventDefault(); drop.style.background='';
          const id = e.dataTransfer.getData('text/plain');
          drop.textContent=''; // d·ªçn v√πng tr∆∞·ªõc khi th·∫£
          // L·∫•y nh√£n hi·ªÉn th·ªã t·ª´ ng√¢n h√†ng token trong scope (n·∫øu c√≥)
          const src = scope.querySelector(`.dd-token[data-id="${id}"]`);
          const chip = document.createElement('span');
          chip.className = 'dd-token';
          chip.textContent = src ? src.textContent : id; // fallback d√πng ID n·∫øu kh√¥ng t√¨m th·∫•y
          chip.setAttribute('data-id', id);
          drop.appendChild(chip);
        });
      });
    }

    /* ======================================
       QUESTION PALETTE (d·∫£i s·ªë c√¢u h·ªèi)
       - renderPalette(): t·∫°o d·∫£i s·ªë theo s·ªë l∆∞·ª£ng c√¢u hi·ªán filter
       - markPalette(): ƒë√°nh d·∫•u √¥ ƒë√£ c√≥ thao t√°c (ƒëi·ªÅn/ch·ªçn/k√©o)
       ====================================== */
    function renderPalette(){
      if(!paletteDiv) return;
      paletteDiv.innerHTML='';
      const qs = filteredQuestions();
      qs.forEach((_,i)=>{
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'q-pal-btn';
        btn.textContent = i+1;
        btn.addEventListener('click',()=>{
          const block = quizDiv.children[i];
          if(block){ block.scrollIntoView({behavior:'smooth', block:'start'}); }
        });
        paletteDiv.appendChild(btn);
      });
    }

    function markPalette(){
      if(!paletteDiv) return;
      const qs = filteredQuestions();
      Array.from(paletteDiv.children).forEach((btn,i)=>{
        const block = quizDiv.children[i];
        let done = false;
        const item = qs[i];
        if(!block || !item) return; // an to√†n khi filter thay ƒë·ªïi nhanh

        // X√°c ƒë·ªãnh "ƒë√£ l√†m" theo t·ª´ng ki·ªÉu
        if(item.type==='truefalse'){
          done = !!block.querySelector('input[type="radio"]:checked');
        }else if(item.type==='fill'){
          done = Array.from(block.querySelectorAll('input[data-blank]')).some(inp=> inp.value.trim()!=='');
        }else if(item.type==='short'){
          done = (block.querySelector('textarea')?.value||'').trim()!=='';
        }else if(item.type==='dragdrop'){
          done = Array.from(block.querySelectorAll('.dd-drop')).some(drop=> drop.querySelector('.dd-token'));
        }
        btn.classList.toggle('done', done);
      });
    }

    /* ======================================
       KH·ªûI T·∫†O & S·ª∞ KI·ªÜN B·ªò L·ªåC
       ====================================== */
    // ·∫®n/hi·ªán ph·∫ßn Quiz
    document.getElementById('toggleQuiz').addEventListener('click',()=>{
      const quizSec=document.getElementById('quizSection');
      quizSec.style.display = (quizSec.style.display==='none') ? 'block' : 'none';
    });

    renderQuiz();
    levelFilter.addEventListener('change', renderQuiz);
    typeFilter.addEventListener('change', renderQuiz);

    // C·∫≠p nh·∫≠t tr·∫°ng th√°i Palette khi ng∆∞·ªùi d√πng nh·∫≠p/ch·ªçn trong ph·∫ßn quiz
    quizDiv.addEventListener('input', markPalette);
    quizDiv.addEventListener('change', markPalette);

    /* ======================================
       CH·∫§M ƒêI·ªÇM
       - Duy·ªát t·ª´ng c√¢u, so kh·ªõp theo ki·ªÉu
       - T√¥ vi·ªÅn xanh/ƒë·ªè & hi·ªán gi·∫£i th√≠ch
       ====================================== */
    document.getElementById('submitQuiz').addEventListener('click',()=>{
      const qs = filteredQuestions();
      let score = 0;
      const blocks = Array.from(quizDiv.children);

      blocks.forEach((block, i)=>{
        const item = qs[i];
        if(!item) return; // an to√†n n·∫øu filter ƒë·ªïi gi·ªØa ch·ª´ng
        const exp = block.querySelector('.explain');
        block.classList.remove('correct','wrong');

        let ok = false;
        if(item.type==='truefalse'){
          const sel = block.querySelector('input[type="radio"]:checked');
          ok = !!sel && (sel.value === String(item.answer));
        }else if(item.type==='fill'){
          ok = true; // gi·∫£ ƒë·ªãnh ƒë√∫ng, n·∫øu c√≥ √¥ sai s·∫Ω g√°n l·∫°i false
          const inputs = block.querySelectorAll('input[data-blank]');
          inputs.forEach((inp, j)=>{
            const val = norm(inp.value);
            const acc = (item.answers[j]||[]).map(norm);
            const hit = acc.includes(val);
            inp.style.borderColor = hit ? 'var(--success)' : 'var(--danger)';
            if(!hit) ok=false;
          });
        }else if(item.type==='short'){
          const val = norm(block.querySelector('textarea').value);
          ok = (item.acceptable||[]).map(norm).some(a=> val.includes(a) || a.includes(val));
        }else if(item.type==='dragdrop'){
          ok = true;
          item.pairs.forEach(p=>{
            const drop = block.querySelector(`.dd-drop[data-target='${p.targetId}']`);
            const id = drop?.querySelector('.dd-token')?.getAttribute('data-id');
            if(id!==p.targetId) ok=false;
          });
        }

        if(ok) score++;
        block.classList.add(ok ? 'correct' : 'wrong');
        const expEl = exp; if(expEl) expEl.hidden = false; // hi·ªán gi·∫£i th√≠ch
      });

      document.getElementById('scoreBox').textContent = `ƒêi·ªÉm: ${score}/${qs.length}`;
      markPalette(); // c·∫≠p nh·∫≠t tr·∫°ng th√°i l√†m b√†i sau khi ch·∫•m
    });

    // L√†m l·∫°i: render l·∫°i to√†n b·ªô ƒë·ªÉ reset tr·∫°ng th√°i & ƒëi·ªÉm
    document.getElementById('resetQuiz').addEventListener('click', renderQuiz);

    /* ======================================
       T·ª∞ KI·ªÇM ("TEST CASES") ‚Äì ch·∫°y nhanh sau khi trang t·∫£i
       - Kh√¥ng thay ƒë·ªïi giao di·ªán ƒë√°ng k·ªÉ; log k·∫øt qu·∫£ ra console
       ====================================== */
    (function runSelfTests(){
      try{
        const logs=[]; let pass=0, fail=0;
        const log = (ok,msg)=>{ (ok?pass:fail) && 0; logs.push((ok?'‚úÖ ':'‚ùå ')+msg); };
        const qs = filteredQuestions();
        // TC1: S·ªë block hi·ªÉn th·ªã == s·ªë c√¢u sau khi l·ªçc
        log(quizDiv.children.length===qs.length, 'TC1: Render s·ªë c√¢u kh·ªõp b·ªô l·ªçc');

        // TC2: N·∫øu c√≥ c√¢u ƒê√∫ng/Sai, tick m·ªôt l·ª±a ch·ªçn r·ªìi ƒë√°nh d·∫•u palette
        const tfIndex = qs.findIndex(q=>q.type==='truefalse');
        if(tfIndex>=0){
          const block = quizDiv.children[tfIndex];
          const radio = block.querySelector("input[type='radio']");
          if(radio){ radio.checked = true; markPalette(); }
          const after = document.querySelectorAll('.q-pal-btn')[tfIndex]?.classList.contains('done');
          log(after===true, 'TC2: Palette ƒë√°nh d·∫•u done khi ch·ªçn ƒê/S');
          if(radio){ radio.checked=false; markPalette(); }
        } else { log(true, 'TC2: B·ªè qua (kh√¥ng c√≥ c√¢u ƒê/S)'); }

        // TC3: N·∫øu c√≥ c√¢u ƒêi·ªÅn, nh·∫≠p ƒë√∫ng 1 √¥ ‚Üí palette done
        const fillIndex = qs.findIndex(q=>q.type==='fill');
        if(fillIndex>=0){
          const item = qs[fillIndex];
          const block = quizDiv.children[fillIndex];
          const inp = block.querySelector('input[data-blank]');
          if(inp){ inp.value = item.answers[0][0]; markPalette(); }
          const after = document.querySelectorAll('.q-pal-btn')[fillIndex]?.classList.contains('done');
          log(after===true, 'TC3: Palette ƒë√°nh d·∫•u done khi ƒëi·ªÅn');
          if(inp){ inp.value=''; markPalette(); }
        } else { log(true, 'TC3: B·ªè qua (kh√¥ng c√≥ c√¢u ƒêi·ªÅn)'); }

        // TC4: K√©o‚Äìth·∫£ ‚Äì t·ªìn t·∫°i v√πng th·∫£ cho c√¢u dragdrop
        const ddIndex = qs.findIndex(q=>q.type==='dragdrop');
        if(ddIndex>=0){
          const block = quizDiv.children[ddIndex];
          const drops = block.querySelectorAll('.dd-drop');
          log(drops.length>0, 'TC4: C√≥ v√πng th·∫£ cho c√¢u k√©o‚Äìth·∫£');
        } else { log(true, 'TC4: B·ªè qua (kh√¥ng c√≥ c√¢u K√©o‚Äìth·∫£)'); }

        // TC5: Khi b·∫•m N·ªôp b√†i ‚Üí t·∫•t c·∫£ gi·∫£i th√≠ch ƒë·ªÅu hi·ªán
        document.getElementById('submitQuiz').click();
        const allExplainsVisible = Array.from(document.querySelectorAll('#quiz .explain')).every(e=>e.hidden===false);
        log(allExplainsVisible, 'TC5: N·ªôp b√†i hi·ªÉn th·ªã gi·∫£i th√≠ch cho t·∫•t c·∫£ c√¢u');

        // TC6: ScoreBox hi·ªÉn th·ªã ƒë√∫ng ƒë·ªãnh d·∫°ng "ƒêi·ªÉm: x/y"
        const scoreText = document.getElementById('scoreBox').textContent.trim();
        log(/^ƒêi·ªÉm:\s*\d+\/\d+$/.test(scoreText), 'TC6: ƒêi·ªÉm hi·ªÉn th·ªã ƒë√∫ng ƒë·ªãnh d·∫°ng');

        // TC7: Palette c√≥ s·ªë n√∫t b·∫±ng s·ªë c√¢u sau khi l·ªçc
        const paletteCount = document.querySelectorAll('#questionPalette .q-pal-btn').length;
        log(paletteCount===qs.length, 'TC7: S·ªë n√∫t palette kh·ªõp s·ªë c√¢u');

        // Hi·ªÉn th·ªã k·∫øt qu·∫£ test ·ªü console v√† m·ªôt d√≤ng nh·ªè ·∫©n d√†nh cho debug
        logs.forEach(l=>console.log(l));
        const status = document.createElement('div');
        status.id='selftestStatus';
        status.style.cssText='margin:8px 0;font-size:.85rem;color:var(--muted)';
        status.textContent = `Ch·∫©n ƒëo√°n: ${logs.filter(l=>l.startsWith('‚úÖ')).length}/${logs.length} tests passed`;
        const heading = document.getElementById('quizSectionHeading');
        if(heading && heading.parentNode){ heading.parentNode.insertBefore(status, heading.nextSibling); }
      }catch(e){ console.error('Self-tests error:', e); }
    })();
  </script>
</body>
</html>
